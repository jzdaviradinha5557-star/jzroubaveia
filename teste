local Players = game:GetService("Players")
local Player = Players.LocalPlayer
local PlayerGui = Player:WaitForChild("PlayerGui")
local UserInputService = game:GetService("UserInputService")
local RunService = game:GetService("RunService")
local Workspace = game:GetService("Workspace")
local LocalPlayer = Players.LocalPlayer
local CoreGui = game:GetService("CoreGui")
local Drawing = Drawing

if not Player then return end

local LARANJA = Color3.fromRGB(255, 140, 0)

local State = {
    speedWalkEnabled = false,
    speedWalkValue = 16,
    noclipEnabled = false,
    flyEnabled = false,
    flySpeed = 50,
    loopBringEnabled = false,
    
    chamsEnabled = false,
    boxEspEnabled = false,
    linesEnabled = false,
    nameEnabled = false,
    distanceEnabled = false,
    espRadius = 600,
    
    dotInvisibilityEnabled = false
}

local Connections = {
    loopBring = nil,
    speedWalk = nil,
    noclip = nil,
    fly = nil,
    espPlayerAdded = nil,
    espPlayerRemoving = nil
}

local FlyControl = {W = false, A = false, S = false, D = false, Space = false, LeftShift = false}
local EspObjects = {}

local hitboxEnabled = false
local hitboxSize = 5
local hitboxTransparency = 1
local processedHeads = {}

local aimbotEnabled = false
local aimbotSmoothing = 0.1
local fovRadius = 120
local fovVisible = true
local aimbotKeybind = nil -- ComeÃ§a sem keybind (sempre ativo)
local aimbotActive = false
local isWaitingForKeybind = false

-- ========================================
-- SISTEMA DE ESP COMPLETO
-- ========================================

local function removeESPForPlayer(player)
    local objs = EspObjects[player]
    if not objs then return end
    
    pcall(function()
        if objs.box then
            for _, line in pairs(objs.box) do
                if line and line.Remove then line:Remove() end
            end
        end
        if objs.tracer and objs.tracer.Remove then objs.tracer:Remove() end
        if objs.nameText and objs.nameText.Remove then objs.nameText:Remove() end
        if objs.distText and objs.distText.Remove then objs.distText:Remove() end
        
        if objs.highlight and objs.highlight.Parent then
            objs.highlight:Destroy()
        end
        
        if objs.conn and objs.conn.Disconnect then
            objs.conn:Disconnect()
        end
    end)
    
    EspObjects[player] = nil
end

local function createESPForPlayer(player)
    if not player or player == LocalPlayer or EspObjects[player] then return end
    
    if not Drawing or type(Drawing.new) ~= "function" then
        return
    end

    local box = {
        Drawing.new("Line"),
        Drawing.new("Line"),
        Drawing.new("Line"),
        Drawing.new("Line")
    }
    
    for _, line in pairs(box) do
        line.Thickness = 2
        line.Color = LARANJA
        line.Transparency = 1
        line.Visible = false
    end
    
    local tracer = Drawing.new("Line")
    tracer.Thickness = 2
    tracer.Color = LARANJA
    tracer.Transparency = 1
    tracer.Visible = false
    
    local nameText = Drawing.new("Text")
    nameText.Size = 16
    nameText.Color = Color3.fromRGB(255, 255, 255)
    nameText.Center = true
    nameText.Outline = true
    nameText.Visible = false
    
    local distText = Drawing.new("Text")
    distText.Size = 14
    distText.Color = Color3.fromRGB(200, 200, 200)
    distText.Center = true
    distText.Outline = true
    distText.Visible = false
    
    local highlight = nil
    
    local conn
    conn = RunService.RenderStepped:Connect(function()
        local char = player.Character
        if not char then
            for _, line in pairs(box) do line.Visible = false end
            tracer.Visible = false
            nameText.Visible = false
            distText.Visible = false
            if highlight then highlight.Enabled = false end
            return
        end

        local root = char:FindFirstChild("HumanoidRootPart") or char:FindFirstChild("UpperTorso")
        local hum = char:FindFirstChild("Humanoid")
        local head = char:FindFirstChild("Head") or char:FindFirstChild("Cabesa")
        
        if not root or not hum or hum.Health <= 0 then
            for _, line in pairs(box) do line.Visible = false end
            tracer.Visible = false
            nameText.Visible = false
            distText.Visible = false
            if highlight then highlight.Enabled = false end
            return
        end

        local myChar = LocalPlayer.Character
        local myRoot = myChar and (myChar:FindFirstChild("HumanoidRootPart") or myChar:FindFirstChild("UpperTorso"))
        if not myRoot then
            for _, line in pairs(box) do line.Visible = false end
            tracer.Visible = false
            nameText.Visible = false
            distText.Visible = false
            if highlight then highlight.Enabled = false end
            return
        end

        local distance = (root.Position - myRoot.Position).Magnitude
        
        if distance > State.espRadius then
            for _, line in pairs(box) do line.Visible = false end
            tracer.Visible = false
            nameText.Visible = false
            distText.Visible = false
            if highlight then highlight.Enabled = false end
            return
        end

        local camera = Workspace.CurrentCamera
        local rootPos, rootOnScreen = camera:WorldToViewportPoint(root.Position)
        
        if State.boxEspEnabled and rootOnScreen and rootPos.Z > 0 then
            local headPos = camera:WorldToViewportPoint((head and head.Position or root.Position) + Vector3.new(0, 0.5, 0))
            local legPos = camera:WorldToViewportPoint(root.Position - Vector3.new(0, 3, 0))
            
            local factor = 1 / rootPos.Z * 1000
            local width = math.clamp(factor, 20, 200)
            
            local topLeft = Vector2.new(rootPos.X - width/2, headPos.Y)
            local topRight = Vector2.new(rootPos.X + width/2, headPos.Y)
            local bottomLeft = Vector2.new(rootPos.X - width/2, legPos.Y)
            local bottomRight = Vector2.new(rootPos.X + width/2, legPos.Y)
            
            box[1].From = topLeft
            box[1].To = topRight
            box[2].From = bottomLeft
            box[2].To = bottomRight
            box[3].From = topLeft
            box[3].To = bottomLeft
            box[4].From = topRight
            box[4].To = bottomRight
            
            for _, line in pairs(box) do
                line.Visible = true
            end
        else
            for _, line in pairs(box) do
                line.Visible = false
            end
        end
        
        if State.linesEnabled and rootOnScreen and rootPos.Z > 0 then
            local screenSize = camera.ViewportSize
            tracer.From = Vector2.new(screenSize.X / 2, screenSize.Y)
            tracer.To = Vector2.new(rootPos.X, rootPos.Y)
            tracer.Visible = true
        else
            tracer.Visible = false
        end
        
        if State.nameEnabled and rootOnScreen and rootPos.Z > 0 then
            local headPos = camera:WorldToViewportPoint((head and head.Position or root.Position) + Vector3.new(0, 0.5, 0))
            nameText.Text = player.Name
            nameText.Position = Vector2.new(rootPos.X, headPos.Y - 20)
            nameText.Visible = true
        else
            nameText.Visible = false
        end
        
        if State.distanceEnabled and rootOnScreen and rootPos.Z > 0 then
            local legPos = camera:WorldToViewportPoint(root.Position - Vector3.new(0, 3, 0))
            distText.Text = string.format("%.1f studs", distance)
            distText.Position = Vector2.new(rootPos.X, legPos.Y + 5)
            distText.Visible = true
        else
            distText.Visible = false
        end
        
        if State.chamsEnabled then
            if not highlight then
                highlight = Instance.new("Highlight")
                highlight.FillColor = LARANJA
                highlight.OutlineColor = Color3.fromRGB(255, 255, 255)
                highlight.FillTransparency = 0.5
                highlight.OutlineTransparency = 0
                highlight.Parent = char
            end
            highlight.Enabled = true
        else
            if highlight then
                highlight.Enabled = false
            end
        end
    end)

    EspObjects[player] = {
        box = box,
        tracer = tracer,
        nameText = nameText,
        distText = distText,
        highlight = highlight,
        conn = conn,
    }
end

local function startESP()
    if Connections.espPlayerAdded then return end
    
    if not Drawing or type(Drawing.new) ~= "function" then
        return
    end
    
    for _, p in pairs(Players:GetPlayers()) do
        if p ~= LocalPlayer then
            createESPForPlayer(p)
        end
    end
    
    Connections.espPlayerAdded = Players.PlayerAdded:Connect(function(player)
        if player ~= LocalPlayer then
            createESPForPlayer(player)
        end
    end)
    
    Connections.espPlayerRemoving = Players.PlayerRemoving:Connect(function(player)
        removeESPForPlayer(player)
    end)
end

local function stopESP()
    for p, _ in pairs(EspObjects) do
        removeESPForPlayer(p)
    end
    
    if Connections.espPlayerAdded then
        Connections.espPlayerAdded:Disconnect()
        Connections.espPlayerAdded = nil
    end
    if Connections.espPlayerRemoving then
        Connections.espPlayerRemoving:Disconnect()
        Connections.espPlayerRemoving = nil
    end
end

local function updateESP()
    if State.chamsEnabled or State.boxEspEnabled or State.linesEnabled or State.nameEnabled or State.distanceEnabled then
        if not Connections.espPlayerAdded then
            startESP()
        end
    else
        stopESP()
    end
end

-- ========================================
-- FIM DO SISTEMA DE ESP
-- ========================================

-- Criar FOV Circle
local fovScreenGui = Instance.new("ScreenGui")
fovScreenGui.Name = "FOVCircle"
fovScreenGui.ResetOnSpawn = false
fovScreenGui.IgnoreGuiInset = true
fovScreenGui.Parent = CoreGui

local fovCircle = Instance.new("Frame")
fovCircle.Size = UDim2.new(0, fovRadius * 2, 0, fovRadius * 2)
fovCircle.AnchorPoint = Vector2.new(0.5, 0.5)
fovCircle.Position = UDim2.new(0.5, 0, 0.5, 0)
fovCircle.BackgroundTransparency = 1
fovCircle.BorderSizePixel = 0
fovCircle.Visible = fovVisible and aimbotEnabled
fovCircle.Parent = fovScreenGui

local fovStroke = Instance.new("UIStroke")
fovStroke.Color = Color3.fromRGB(255, 255, 255)
fovStroke.Thickness = 1
fovStroke.Transparency = 0.3
fovStroke.Parent = fovCircle

local fovCorner = Instance.new("UICorner")
fovCorner.CornerRadius = UDim.new(1, 0)
fovCorner.Parent = fovCircle

RunService.RenderStepped:Connect(function()
    fovCircle.Size = UDim2.new(0, fovRadius * 2, 0, fovRadius * 2)
    fovCircle.Visible = fovVisible and aimbotEnabled
end)

-- Hitbox Functions
local bodyParts = {
    "HumanoidRootPart", "UpperTorso", "LowerTorso",
    "RightUpperArm", "RightLowerArm", "RightHand",
    "LeftUpperArm", "LeftLowerArm", "LeftHand",
    "RightUpperLeg", "RightLowerLeg", "RightFoot",
    "LeftUpperLeg", "LeftLowerLeg", "LeftFoot"
}

local function isCommonBodyPart(partName)
    for _, name in ipairs(bodyParts) do
        if partName == name then return true end
    end
    return false
end

local function hasWeirdName(partName)
    if partName:match("[#%%&*$@!]") then return true end
    
    local hasUpper = partName:match("[A-Z]")
    local hasLower = partName:match("[a-z]")
    local hasNumber = partName:match("[0-9]")
    
    local count = 0
    if hasUpper then count = count + 1 end
    if hasLower then count = count + 1 end
    if hasNumber then count = count + 1 end
    
    if count >= 2 and #partName >= 8 then return true end
    return false
end

local function processCharacter(character)
    if not character or character.Parent ~= Workspace then return end
    
    local player = Players:GetPlayerFromCharacter(character)
    if player == LocalPlayer then return end
    
    for _, part in ipairs(character:GetChildren()) do
        if part:IsA("BasePart") and not isCommonBodyPart(part.Name) and hasWeirdName(part.Name) then
            if processedHeads[part] then 
                part.Size = Vector3.new(hitboxSize, hitboxSize, hitboxSize)
                part.Transparency = hitboxTransparency
                continue 
            end
            
            pcall(function()
                for _, child in ipairs(part:GetChildren()) do
                    if child:IsA("SpecialMesh") or child:IsA("Mesh") or child:IsA("Decal") then
                        child:Destroy()
                    end
                end
                
                part.Size = Vector3.new(hitboxSize, hitboxSize, hitboxSize)
                part.Transparency = hitboxTransparency
                part.CanCollide = false
                part.Massless = true
                
                processedHeads[part] = true
            end)
        end
    end
end

RunService.Heartbeat:Connect(function()
    if not hitboxEnabled then return end
    
    for _, player in ipairs(Players:GetPlayers()) do
        if player ~= LocalPlayer and player.Character and player.Character.Parent == Workspace then
            processCharacter(player.Character)
        end
    end
end)

-- FunÃ§Ãµes bÃ¡sicas
local function startSpeedWalk()
    local char = Player.Character
    local humanoid = char and char:FindFirstChild("Humanoid")
    if humanoid then humanoid.WalkSpeed = State.speedWalkValue end
end

local function stopSpeedWalk()
    local char = Player.Character
    local humanoid = char and char:FindFirstChild("Humanoid")
    if humanoid then humanoid.WalkSpeed = 16 end
end

local function startNoclip()
    if Connections.noclip then return end
    Connections.noclip = RunService.Stepped:Connect(function()
        if not State.noclipEnabled then return end
        local char = Player.Character
        if char then
            for _, part in pairs(char:GetDescendants()) do
                if part:IsA("BasePart") then part.CanCollide = false end
            end
        end
    end)
end

local function stopNoclip()
    if Connections.noclip then Connections.noclip:Disconnect() Connections.noclip = nil end
    local char = Player.Character
    if char then
        for _, part in pairs(char:GetDescendants()) do
            if part:IsA("BasePart") then part.CanCollide = true end
        end
    end
end

local function startFly()
    if Connections.fly then return end
    local char = Player.Character
    local root = char and char:FindFirstChild("HumanoidRootPart")
    if not root then return end
    
    local vel = Instance.new("BodyVelocity")
    vel.MaxForce = Vector3.new(9e9, 9e9, 9e9)
    vel.Parent = root
    
    local gyro = Instance.new("BodyGyro")
    gyro.MaxTorque = Vector3.new(9e9, 9e9, 9e9)
    gyro.P = 9e9
    gyro.CFrame = root.CFrame
    gyro.Parent = root
    
    Connections.fly = RunService.Heartbeat:Connect(function()
        if not State.flyEnabled then return end
        
        local char = Player.Character
        local root = char and char:FindFirstChild("HumanoidRootPart")
        if not root or not vel or not gyro then stopFly() return end
        
        local dir = Vector3.new(0, 0, 0)
        local cam = Workspace.CurrentCamera
        
        if FlyControl.W then dir = dir + cam.CFrame.LookVector * State.flySpeed end
        if FlyControl.S then dir = dir - cam.CFrame.LookVector * State.flySpeed end
        if FlyControl.A then dir = dir - cam.CFrame.RightVector * State.flySpeed end
        if FlyControl.D then dir = dir + cam.CFrame.RightVector * State.flySpeed end
        if FlyControl.Space then dir = dir + Vector3.new(0, State.flySpeed, 0) end
        if FlyControl.LeftShift then dir = dir - Vector3.new(0, State.flySpeed, 0) end
        
        vel.Velocity = dir
        gyro.CFrame = cam.CFrame
    end)
end

local function stopFly()
    if Connections.fly then Connections.fly:Disconnect() Connections.fly = nil end
    local char = Player.Character
    local root = char and char:FindFirstChild("HumanoidRootPart")
    if root then
        local vel = root:FindFirstChild("BodyVelocity")
        local gyro = root:FindFirstChild("BodyGyro")
        if vel then vel:Destroy() end
        if gyro then gyro:Destroy() end
    end
    for k in pairs(FlyControl) do FlyControl[k] = false end
end

local function startLoopBring()
    if Connections.loopBring then return end
    Connections.loopBring = RunService.Heartbeat:Connect(function()
        if not State.loopBringEnabled then return end
        local char = Player.Character
        local root = char and char:FindFirstChild("HumanoidRootPart")
        if not root then return end
        
        for _, p in pairs(Players:GetPlayers()) do
            if p ~= Player and p.Character then
                local pRoot = p.Character:FindFirstChild("HumanoidRootPart")
                if pRoot and (pRoot.Position - root.Position).Magnitude <= 600 then
                    pRoot.CFrame = root.CFrame * CFrame.new(0, 0, -8)
                end
            end
        end
    end)
end

local function stopLoopBring()
    if Connections.loopBring then Connections.loopBring:Disconnect() Connections.loopBring = nil end
end

-- Aimbot Functions
local function findHead(character)
    for _, part in ipairs(character:GetChildren()) do
        if part:IsA("BasePart") and not isCommonBodyPart(part.Name) and hasWeirdName(part.Name) then
            return part
        end
    end
    return nil
end

local function canSeeTarget(targetPart)
    local origin = Workspace.CurrentCamera.CFrame.Position
    local direction = (targetPart.Position - origin)
    local raycastParams = RaycastParams.new()
    raycastParams.FilterDescendantsInstances = {LocalPlayer.Character}
    raycastParams.FilterType = Enum.RaycastFilterType.Blacklist
    
    local raycastResult = Workspace:Raycast(origin, direction, raycastParams)
    
    if raycastResult then
        if raycastResult.Instance:IsDescendantOf(targetPart.Parent) then
            return true
        else
            return false
        end
    else
        return true
    end
end

local function getClosestTarget()
    if not aimbotEnabled or not aimbotActive then return nil end
    
    local closestPart, closestDistance = nil, math.huge
    local camera = Workspace.CurrentCamera
    local screenCenter = Vector2.new(camera.ViewportSize.X/2, camera.ViewportSize.Y/2)
    
    for _, player in pairs(Players:GetPlayers()) do
        if player ~= LocalPlayer and player.Character then
            local humanoid = player.Character:FindFirstChild("Humanoid")
            if humanoid and humanoid.Health > 0 then
                local headPart = findHead(player.Character)
                if headPart then
                    local pos, onScreen = camera:WorldToViewportPoint(headPart.Position)
                    
                    if onScreen then
                        local dist = (Vector2.new(pos.X, pos.Y) - screenCenter).Magnitude
                        if dist <= fovRadius then
                            if canSeeTarget(headPart) then
                                if dist < closestDistance then
                                    closestDistance = dist
                                    closestPart = headPart
                                end
                            end
                        end
                    end
                end
            end
        end
    end
    
    return closestPart
end

RunService.RenderStepped:Connect(function()
    if not aimbotEnabled or not aimbotActive then return end
    
    local targetPart = getClosestTarget()
    if targetPart then
        local camera = Workspace.CurrentCamera
        local currentCFrame = camera.CFrame
        local targetPosition = targetPart.Position
        
        local newCFrame = CFrame.new(currentCFrame.Position, targetPosition)
        camera.CFrame = currentCFrame:Lerp(newCFrame, 1 - aimbotSmoothing)
    end
end)

-- FunÃ§Ã£o para converter KeyCode em string legÃ­vel
local function getKeyName(keyCode)
    local keyName = tostring(keyCode):gsub("Enum.KeyCode.", "")
    return keyName
end

-- Input System
UserInputService.InputBegan:Connect(function(input, gameProcessed)
    if gameProcessed then return end
    
    -- Sistema de aguardar keybind
    if isWaitingForKeybind then
        if input.KeyCode == Enum.KeyCode.Nine then
            -- Tecla 9 = BotÃ£o direito do mouse
            aimbotKeybind = "MouseButton2"
            isWaitingForKeybind = false
            return
        elseif input.KeyCode == Enum.KeyCode.Zero then
            -- Tecla 0 = Sem keybind (sempre ativo)
            aimbotKeybind = nil
            isWaitingForKeybind = false
            return
        elseif input.KeyCode ~= Enum.KeyCode.Unknown and input.UserInputType == Enum.UserInputType.Keyboard then
            aimbotKeybind = input.KeyCode
            isWaitingForKeybind = false
            return
        end
    end
    
    -- AtivaÃ§Ã£o do aimbot
    if aimbotEnabled then
        if aimbotKeybind == nil then
            -- Sem keybind = sempre ativo
            aimbotActive = true
        elseif aimbotKeybind == "MouseButton2" then
            if input.UserInputType == Enum.UserInputType.MouseButton2 then
                aimbotActive = true
            end
        elseif input.KeyCode == aimbotKeybind then
            aimbotActive = true
        end
    end
    
    if State.flyEnabled then
        if input.KeyCode == Enum.KeyCode.W then FlyControl.W = true
        elseif input.KeyCode == Enum.KeyCode.A then FlyControl.A = true
        elseif input.KeyCode == Enum.KeyCode.S then FlyControl.S = true
        elseif input.KeyCode == Enum.KeyCode.D then FlyControl.D = true
        elseif input.KeyCode == Enum.KeyCode.Space then FlyControl.Space = true
        elseif input.KeyCode == Enum.KeyCode.LeftShift then FlyControl.LeftShift = true
        end
    end
end)

UserInputService.InputEnded:Connect(function(input)
    if aimbotEnabled then
        if aimbotKeybind == "MouseButton2" then
            if input.UserInputType == Enum.UserInputType.MouseButton2 then
                aimbotActive = false
            end
        elseif aimbotKeybind and input.KeyCode == aimbotKeybind then
            aimbotActive = false
        end
    end
    
    if State.flyEnabled then
        if input.KeyCode == Enum.KeyCode.W then FlyControl.W = false
        elseif input.KeyCode == Enum.KeyCode.A then FlyControl.A = false
        elseif input.KeyCode == Enum.KeyCode.S then FlyControl.S = false
        elseif input.KeyCode == Enum.KeyCode.D then FlyControl.D = false
        elseif input.KeyCode == Enum.KeyCode.Space then FlyControl.Space = false
        elseif input.KeyCode == Enum.KeyCode.LeftShift then FlyControl.LeftShift = false
        end
    end
end)

-- UI Creation
local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "LocalPlayerMenu"
ScreenGui.ResetOnSpawn = false
ScreenGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
ScreenGui.Parent = PlayerGui

local MainContainer = Instance.new("Frame")
MainContainer.Name = "MainContainer"
MainContainer.Size = UDim2.new(0, 360, 0, 400)
MainContainer.Position = UDim2.new(0.5, -180, 0.5, -200)
MainContainer.BackgroundColor3 = Color3.fromRGB(29, 29, 29)
MainContainer.BorderSizePixel = 0
MainContainer.Parent = ScreenGui

local MainCorner = Instance.new("UICorner")
MainCorner.CornerRadius = UDim.new(0, 12)
MainCorner.Parent = MainContainer

local MainGradient = Instance.new("UIGradient")
MainGradient.Color = ColorSequence.new{
    ColorSequenceKeypoint.new(0, Color3.fromRGB(45, 45, 45)),
    ColorSequenceKeypoint.new(1, Color3.fromRGB(26, 26, 26))
}
MainGradient.Rotation = 90
MainGradient.Parent = MainContainer

local MinimizeButton = Instance.new("TextButton")
MinimizeButton.Name = "MinimizeButton"
MinimizeButton.Size = UDim2.new(0, 12, 0, 12)
MinimizeButton.Position = UDim2.new(1, -20, 0, 10)
MinimizeButton.BackgroundColor3 = LARANJA
MinimizeButton.BorderSizePixel = 0
MinimizeButton.Text = ""
MinimizeButton.ZIndex = 2
MinimizeButton.Parent = MainContainer

local MinimizeCorner = Instance.new("UICorner")
MinimizeCorner.CornerRadius = UDim.new(1, 0)
MinimizeCorner.Parent = MinimizeButton

local MinimizedDot = Instance.new("TextButton")
MinimizedDot.Name = "MinimizedDot"
MinimizedDot.Size = UDim2.new(0, 20, 0, 20)
MinimizedDot.Position = UDim2.new(0, 20, 0, 20)
MinimizedDot.BackgroundColor3 = LARANJA
MinimizedDot.BorderSizePixel = 0
MinimizedDot.Text = ""
MinimizedDot.Visible = false
MinimizedDot.ZIndex = 3
MinimizedDot.Parent = ScreenGui

local DotCorner = Instance.new("UICorner")
DotCorner.CornerRadius = UDim.new(1, 0)
DotCorner.Parent = MinimizedDot

local Sidebar = Instance.new("Frame")
Sidebar.Name = "Sidebar"
Sidebar.Size = UDim2.new(0, 90, 1, 0)
Sidebar.BackgroundColor3 = Color3.fromRGB(10, 10, 10)
Sidebar.BorderSizePixel = 0
Sidebar.Parent = MainContainer

local SidebarCorner = Instance.new("UICorner")
SidebarCorner.CornerRadius = UDim.new(0, 12)
SidebarCorner.Parent = Sidebar

local Border = Instance.new("Frame")
Border.Size = UDim2.new(0, 2, 1, 0)
Border.Position = UDim2.new(1, 0, 0, 0)
Border.BackgroundColor3 = LARANJA
Border.BorderSizePixel = 0
Border.Parent = Sidebar

local Logo = Instance.new("ImageLabel")
Logo.Name = "Logo"
Logo.Size = UDim2.new(0, 60, 0, 60)
Logo.Position = UDim2.new(0.5, -30, 0, 10)
Logo.BackgroundColor3 = Color3.fromRGB(20, 20, 20)
Logo.BorderSizePixel = 0
Logo.Image = "rbxassetid://94974019799974"
Logo.ScaleType = Enum.ScaleType.Fit
Logo.Parent = Sidebar

local LogoCorner = Instance.new("UICorner")
LogoCorner.CornerRadius = UDim.new(0, 12)
LogoCorner.Parent = Logo

local ContentArea = Instance.new("Frame")
ContentArea.Name = "ContentArea"
ContentArea.Size = UDim2.new(1, -90, 1, 0)
ContentArea.Position = UDim2.new(0, 90, 0, 0)
ContentArea.BackgroundTransparency = 1
ContentArea.Parent = MainContainer

local TabsContainer = Instance.new("Frame")
TabsContainer.Name = "TabsContainer"
TabsContainer.Size = UDim2.new(1, -20, 0, 30)
TabsContainer.Position = UDim2.new(0, 10, 0, 10)
TabsContainer.BackgroundTransparency = 1
TabsContainer.Parent = ContentArea

local TabBorder = Instance.new("Frame")
TabBorder.Size = UDim2.new(1, 0, 0, 1)
TabBorder.Position = UDim2.new(0, 0, 1, -1)
TabBorder.BackgroundColor3 = Color3.fromRGB(51, 51, 51)
TabBorder.BorderSizePixel = 0
TabBorder.Parent = TabsContainer

local AimSection = Instance.new("Frame")
AimSection.Name = "AimSection"
AimSection.Size = UDim2.new(1, -20, 1, -50)
AimSection.Position = UDim2.new(0, 10, 0, 45)
AimSection.BackgroundTransparency = 1
AimSection.Visible = true
AimSection.Parent = ContentArea

local EspSection = Instance.new("Frame")
EspSection.Name = "EspSection"
EspSection.Size = UDim2.new(1, -20, 1, -50)
EspSection.Position = UDim2.new(0, 10, 0, 45)
EspSection.BackgroundTransparency = 1
EspSection.Visible = false
EspSection.Parent = ContentArea

local MiscSection = Instance.new("Frame")
MiscSection.Name = "MiscSection"
MiscSection.Size = UDim2.new(1, -20, 1, -50)
MiscSection.Position = UDim2.new(0, 10, 0, 45)
MiscSection.BackgroundTransparency = 1
MiscSection.Visible = false
MiscSection.Parent = ContentArea

-- FunÃ§Ãµes UI
local function createToggle(parent, text, position, defaultValue, callback)
    local toggleFrame = Instance.new("Frame")
    toggleFrame.Size = UDim2.new(1, 0, 0, 25)
    toggleFrame.Position = position
    toggleFrame.BackgroundTransparency = 1
    toggleFrame.Parent = parent

    local label = Instance.new("TextLabel")
    label.Size = UDim2.new(0.6, 0, 1, 0)
    label.BackgroundTransparency = 1
    label.Text = text .. (defaultValue and ": On" or ": Off")
    label.TextColor3 = Color3.fromRGB(255, 255, 255)
    label.TextSize = 11
    label.Font = Enum.Font.GothamSemibold
    label.TextXAlignment = Enum.TextXAlignment.Left
    label.Parent = toggleFrame

    local toggleButton = Instance.new("TextButton")
    toggleButton.Size = UDim2.new(0, 40, 0, 18)
    toggleButton.Position = UDim2.new(1, -40, 0, 3)
    toggleButton.BackgroundColor3 = defaultValue and LARANJA or Color3.fromRGB(59, 59, 59)
    toggleButton.AutoButtonColor = false
    toggleButton.Text = ""
    toggleButton.Parent = toggleFrame

    local toggleCorner = Instance.new("UICorner")
    toggleCorner.CornerRadius = UDim.new(0, 9)
    toggleCorner.Parent = toggleButton

    local toggleThumb = Instance.new("Frame")
    toggleThumb.Size = UDim2.new(0, 14, 0, 14)
    toggleThumb.Position = defaultValue and UDim2.new(0, 24, 0, 2) or UDim2.new(0, 2, 0, 2)
    toggleThumb.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
    toggleThumb.Parent = toggleButton

    local thumbCorner = Instance.new("UICorner")
    thumbCorner.CornerRadius = UDim.new(0, 7)
    thumbCorner.Parent = toggleThumb

    local isToggled = defaultValue

    local function updateToggle()
        if isToggled then
            toggleThumb.Position = UDim2.new(0, 24, 0, 2)
            toggleButton.BackgroundColor3 = LARANJA
            label.Text = text .. ": On"
        else
            toggleThumb.Position = UDim2.new(0, 2, 0, 2)
            toggleButton.BackgroundColor3 = Color3.fromRGB(59, 59, 59)
            label.Text = text .. ": Off"
        end
    end

    toggleButton.MouseButton1Click:Connect(function()
        isToggled = not isToggled
        updateToggle()
        if callback then callback(isToggled) end
    end)

    return toggleFrame
end

local function createButtonControl(parent, text, position, minValue, maxValue, defaultValue, step, callback)
    local controlFrame = Instance.new("Frame")
    controlFrame.Size = UDim2.new(1, 0, 0, 28)
    controlFrame.Position = position
    controlFrame.BackgroundTransparency = 1
    controlFrame.Parent = parent

    local label = Instance.new("TextLabel")
    label.Size = UDim2.new(0.5, 0, 1, 0)
    label.BackgroundTransparency = 1
    label.Text = text .. ": " .. defaultValue
    label.TextColor3 = Color3.fromRGB(255, 255, 255)
    label.TextSize = 11
    label.Font = Enum.Font.GothamSemibold
    label.TextXAlignment = Enum.TextXAlignment.Left
    label.Parent = controlFrame

    local decreaseButton = Instance.new("TextButton")
    decreaseButton.Size = UDim2.new(0, 28, 0, 22)
    decreaseButton.Position = UDim2.new(1, -85, 0, 3)
    decreaseButton.BackgroundColor3 = Color3.fromRGB(59, 59, 59)
    decreaseButton.Text = "-"
    decreaseButton.TextColor3 = Color3.fromRGB(255, 255, 255)
    decreaseButton.TextSize = 16
    decreaseButton.Font = Enum.Font.GothamBold
    decreaseButton.Parent = controlFrame

    local decreaseCorner = Instance.new("UICorner")
    decreaseCorner.CornerRadius = UDim.new(0, 6)
    decreaseCorner.Parent = decreaseButton

    local valueDisplay = Instance.new("TextLabel")
    valueDisplay.Size = UDim2.new(0, 25, 0, 22)
    valueDisplay.Position = UDim2.new(1, -55, 0, 3)
    valueDisplay.BackgroundColor3 = Color3.fromRGB(35, 35, 35)
    valueDisplay.Text = tostring(defaultValue)
    valueDisplay.TextColor3 = Color3.fromRGB(255, 255, 255)
    valueDisplay.TextSize = 11
    valueDisplay.Font = Enum.Font.GothamBold
    valueDisplay.Parent = controlFrame

    local displayCorner = Instance.new("UICorner")
    displayCorner.CornerRadius = UDim.new(0, 6)
    displayCorner.Parent = valueDisplay

    local increaseButton = Instance.new("TextButton")
    increaseButton.Size = UDim2.new(0, 28, 0, 22)
    increaseButton.Position = UDim2.new(1, -28, 0, 3)
    increaseButton.BackgroundColor3 = Color3.fromRGB(59, 59, 59)
    increaseButton.Text = "+"
    increaseButton.TextColor3 = Color3.fromRGB(255, 255, 255)
    increaseButton.TextSize = 16
    increaseButton.Font = Enum.Font.GothamBold
    increaseButton.Parent = controlFrame

    local increaseCorner = Instance.new("UICorner")
    increaseCorner.CornerRadius = UDim.new(0, 6)
    increaseCorner.Parent = increaseButton

    local currentValue = defaultValue

    local function updateValue(newValue)
        currentValue = math.clamp(newValue, minValue, maxValue)
        valueDisplay.Text = tostring(currentValue)
        label.Text = text .. ": " .. currentValue
        if callback then callback(currentValue) end
    end

    decreaseButton.MouseButton1Click:Connect(function()
        updateValue(currentValue - step)
    end)

    increaseButton.MouseButton1Click:Connect(function()
        updateValue(currentValue + step)
    end)

    return controlFrame
end

local function createSmoothControl(parent, text, position, minValue, maxValue, defaultValue, step, callback)
    local controlFrame = Instance.new("Frame")
    controlFrame.Size = UDim2.new(1, 0, 0, 28)
    controlFrame.Position = position
    controlFrame.BackgroundTransparency = 1
    controlFrame.Parent = parent

    local label = Instance.new("TextLabel")
    label.Size = UDim2.new(0.5, 0, 1, 0)
    label.BackgroundTransparency = 1
    label.Text = text .. ": " .. string.format("%.2f", defaultValue)
    label.TextColor3 = Color3.fromRGB(255, 255, 255)
    label.TextSize = 11
    label.Font = Enum.Font.GothamSemibold
    label.TextXAlignment = Enum.TextXAlignment.Left
    label.Parent = controlFrame

    local decreaseButton = Instance.new("TextButton")
    decreaseButton.Size = UDim2.new(0, 28, 0, 22)
    decreaseButton.Position = UDim2.new(1, -85, 0, 3)
    decreaseButton.BackgroundColor3 = Color3.fromRGB(59, 59, 59)
    decreaseButton.Text = "-"
    decreaseButton.TextColor3 = Color3.fromRGB(255, 255, 255)
    decreaseButton.TextSize = 16
    decreaseButton.Font = Enum.Font.GothamBold
    decreaseButton.Parent = controlFrame

    local decreaseCorner = Instance.new("UICorner")
    decreaseCorner.CornerRadius = UDim.new(0, 6)
    decreaseCorner.Parent = decreaseButton

    local valueDisplay = Instance.new("TextLabel")
    valueDisplay.Size = UDim2.new(0, 25, 0, 22)
    valueDisplay.Position = UDim2.new(1, -55, 0, 3)
    valueDisplay.BackgroundColor3 = Color3.fromRGB(35, 35, 35)
    valueDisplay.Text = string.format("%.2f", defaultValue)
    valueDisplay.TextColor3 = Color3.fromRGB(255, 255, 255)
    valueDisplay.TextSize = 11
    valueDisplay.Font = Enum.Font.GothamBold
    valueDisplay.Parent = controlFrame

    local displayCorner = Instance.new("UICorner")
    displayCorner.CornerRadius = UDim.new(0, 6)
    displayCorner.Parent = valueDisplay

    local increaseButton = Instance.new("TextButton")
    increaseButton.Size = UDim2.new(0, 28, 0, 22)
    increaseButton.Position = UDim2.new(1, -28, 0, 3)
    increaseButton.BackgroundColor3 = Color3.fromRGB(59, 59, 59)
    increaseButton.Text = "+"
    increaseButton.TextColor3 = Color3.fromRGB(255, 255, 255)
    increaseButton.TextSize = 16
    increaseButton.Font = Enum.Font.GothamBold
    increaseButton.Parent = controlFrame

    local increaseCorner = Instance.new("UICorner")
    increaseCorner.CornerRadius = UDim.new(0, 6)
    increaseCorner.Parent = increaseButton

    local currentValue = defaultValue

    local function updateValue(newValue)
        currentValue = math.clamp(newValue, minValue, maxValue)
        valueDisplay.Text = string.format("%.2f", currentValue)
        label.Text = text .. ": " .. string.format("%.2f", currentValue)
        if callback then callback(currentValue) end
    end

    decreaseButton.MouseButton1Click:Connect(function()
        updateValue(currentValue - step)
    end)

    increaseButton.MouseButton1Click:Connect(function()
        updateValue(currentValue + step)
    end)

    return controlFrame
end

-- FunÃ§Ã£o para criar botÃ£o de keybind
local keybindButton
local keybindDisplay

local function updateKeybindDisplay()
    if aimbotKeybind == nil then
        keybindDisplay.Text = "Keybind: Sem Bind (Sempre Ativo)"
        keybindDisplay.TextColor3 = Color3.fromRGB(0, 255, 0)
        keybindButton.Text = "Sem Bind"
    elseif aimbotKeybind == "MouseButton2" then
        keybindDisplay.Text = "Keybind: BotÃ£o Direito Mouse"
        keybindDisplay.TextColor3 = LARANJA
        keybindButton.Text = "Mouse2"
    else
        local keyName = getKeyName(aimbotKeybind)
        keybindDisplay.Text = "Keybind: " .. keyName
        keybindDisplay.TextColor3 = LARANJA
        keybindButton.Text = keyName
    end
end

local function createKeybindButton(parent, position)
    local buttonFrame = Instance.new("Frame")
    buttonFrame.Size = UDim2.new(1, 0, 0, 28)
    buttonFrame.Position = position
    buttonFrame.BackgroundTransparency = 1
    buttonFrame.Parent = parent

    local label = Instance.new("TextLabel")
    label.Size = UDim2.new(0.5, 0, 1, 0)
    label.BackgroundTransparency = 1
    label.Text = "Mudar Keybind"
    label.TextColor3 = Color3.fromRGB(255, 255, 255)
    label.TextSize = 11
    label.Font = Enum.Font.GothamSemibold
    label.TextXAlignment = Enum.TextXAlignment.Left
    label.Parent = buttonFrame

    keybindButton = Instance.new("TextButton")
    keybindButton.Size = UDim2.new(0, 85, 0, 22)
    keybindButton.Position = UDim2.new(1, -85, 0, 3)
    keybindButton.BackgroundColor3 = Color3.fromRGB(59, 59, 59)
    keybindButton.Text = "Sem Bind"
    keybindButton.TextColor3 = Color3.fromRGB(255, 255, 255)
    keybindButton.TextSize = 10
    keybindButton.Font = Enum.Font.GothamBold
    keybindButton.Parent = buttonFrame

    local buttonCorner = Instance.new("UICorner")
    buttonCorner.CornerRadius = UDim.new(0, 6)
    buttonCorner.Parent = keybindButton

    keybindButton.MouseButton1Click:Connect(function()
        isWaitingForKeybind = true
        keybindButton.Text = "..."
        keybindButton.BackgroundColor3 = LARANJA
        
        task.wait(5)
        if isWaitingForKeybind then
            isWaitingForKeybind = false
            keybindButton.BackgroundColor3 = Color3.fromRGB(59, 59, 59)
            updateKeybindDisplay()
        end
    end)
    
    task.spawn(function()
        while task.wait(0.1) do
            if not isWaitingForKeybind then
                keybindButton.BackgroundColor3 = Color3.fromRGB(59, 59, 59)
                updateKeybindDisplay()
            end
        end
    end)

    return buttonFrame
end

-- Aimbot Controls
createToggle(AimSection, "Aimbot", UDim2.new(0, 0, 0, 0), false, function(enabled)
    aimbotEnabled = enabled
    aimbotActive = enabled and aimbotKeybind == nil
end)

createToggle(AimSection, "Fov", UDim2.new(0, 0, 0, 30), true, function(enabled)
    fovVisible = enabled
end)

createToggle(AimSection, "HeadSize", UDim2.new(0, 0, 0, 60), false, function(enabled)
    hitboxEnabled = enabled
    if not enabled then
        processedHeads = {}
    end
end)

createButtonControl(AimSection, "Head Size", UDim2.new(0, 0, 0, 95), 1, 10, 5, 1, function(value)
    hitboxSize = value
end)

createButtonControl(AimSection, "Opacity", UDim2.new(0, 0, 0, 130), 0, 1, 1, 0.1, function(value)
    hitboxTransparency = value
end)

createButtonControl(AimSection, "FOV Size", UDim2.new(0, 0, 0, 165), 10, 600, 120, 10, function(value)
    fovRadius = value
end)

createSmoothControl(AimSection, "Smooth", UDim2.new(0, 0, 0, 200), 0.01, 1, 0.1, 0.01, function(value)
    aimbotSmoothing = value
end)

createKeybindButton(AimSection, UDim2.new(0, 0, 0, 235))

keybindDisplay = Instance.new("TextLabel")
keybindDisplay.Size = UDim2.new(1, 0, 0, 20)
keybindDisplay.Position = UDim2.new(0, 0, 0, 270)
keybindDisplay.BackgroundTransparency = 1
keybindDisplay.Text = "Keybind: Sem Bind (Sempre Ativo)"
keybindDisplay.TextColor3 = Color3.fromRGB(0, 255, 0)
keybindDisplay.TextSize = 10
keybindDisplay.Font = Enum.Font.GothamSemibold
keybindDisplay.TextXAlignment = Enum.TextXAlignment.Left
keybindDisplay.Parent = AimSection

local infoText = Instance.new("TextLabel")
infoText.Size = UDim2.new(1, 0, 0, 40)
infoText.Position = UDim2.new(0, 0, 0, 295)
infoText.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
infoText.TextColor3 = Color3.fromRGB(200, 200, 200)
infoText.Text = "9 = Mouse2 | 0 = Sem Bind"
infoText.TextSize = 10
infoText.Font = Enum.Font.GothamSemibold
infoText.TextWrapped = true
infoText.Parent = AimSection

local infoCorner = Instance.new("UICorner")
infoCorner.CornerRadius = UDim.new(0, 6)
infoCorner.Parent = infoText

-- ESP Controls
createToggle(EspSection, "ESP Chams", UDim2.new(0, 0, 0, 0), false, function(enabled)
    State.chamsEnabled = enabled
    updateESP()
end)

createToggle(EspSection, "Esp Box", UDim2.new(0, 0, 0, 30), false, function(enabled)
    State.boxEspEnabled = enabled
    updateESP()
end)

createToggle(EspSection, "Lines", UDim2.new(0, 0, 0, 60), false, function(enabled)
    State.linesEnabled = enabled
    updateESP()
end)

createToggle(EspSection, "Name", UDim2.new(0, 0, 0, 90), false, function(enabled)
    State.nameEnabled = enabled
    updateESP()
end)

createToggle(EspSection, "Distance", UDim2.new(0, 0, 0, 120), false, function(enabled)
    State.distanceEnabled = enabled
    updateESP()
end)

createButtonControl(EspSection, "ESP Radius", UDim2.new(0, 0, 0, 155), 50, 2000, 600, 50, function(value)
    State.espRadius = value
end)

-- Misc Controls
createToggle(MiscSection, "Speed Hack", UDim2.new(0, 0, 0, 0), false, function(enabled)
    State.speedWalkEnabled = enabled
    if enabled then startSpeedWalk() else stopSpeedWalk() end
end)

createButtonControl(MiscSection, "Walk Speed", UDim2.new(0, 0, 0, 30), 16, 200, 16, 5, function(value)
    State.speedWalkValue = value
    if State.speedWalkEnabled then startSpeedWalk() end
end)

createToggle(MiscSection, "LoopBring", UDim2.new(0, 0, 0, 65), false, function(enabled)
    State.loopBringEnabled = enabled
    if enabled then startLoopBring() else stopLoopBring() end
end)

createToggle(MiscSection, "No Clip", UDim2.new(0, 0, 0, 95), false, function(enabled)
    State.noclipEnabled = enabled
    if enabled then startNoclip() else stopNoclip() end
end)

createToggle(MiscSection, "Fly", UDim2.new(0, 0, 0, 125), false, function(enabled)
    State.flyEnabled = enabled
    if enabled then startFly() else stopFly() end
end)

createButtonControl(MiscSection, "Fly Speed", UDim2.new(0, 0, 0, 160), 10, 200, 50, 5, function(value)
    State.flySpeed = value
end)

createToggle(MiscSection, "Hide Dot", UDim2.new(0, 0, 0, 195), false, function(enabled)
    State.dotInvisibilityEnabled = enabled
    MinimizedDot.BackgroundTransparency = enabled and 1 or 0
end)

local warningText = Instance.new("TextLabel")
warningText.Size = UDim2.new(1, 0, 0, 40)
warningText.Position = UDim2.new(0, 0, 0, 230)
warningText.BackgroundColor3 = Color3.fromRGB(200, 0, 0)
warningText.TextColor3 = Color3.fromRGB(255, 255, 255)
warningText.Text = "NÃƒO ATIVE NADA!!!"
warningText.TextSize = 14
warningText.Font = Enum.Font.GothamBold
warningText.TextScaled = true
warningText.Parent = MiscSection

local warningCorner = Instance.new("UICorner")
warningCorner.CornerRadius = UDim.new(0, 8)
warningCorner.Parent = warningText

local warningStroke = Instance.new("UIStroke")
warningStroke.Color = Color3.fromRGB(255, 255, 255)
warningStroke.Thickness = 2
warningStroke.Parent = warningText

local currentTab = nil
local function createTab(text, position, isActive, targetSection)
    local tab = Instance.new("TextButton")
    tab.Size = UDim2.new(0, 80, 1, 0)
    tab.Position = UDim2.new(0, position, 0, 0)
    tab.BackgroundTransparency = 1
    tab.Text = text
    tab.TextColor3 = isActive and Color3.fromRGB(255, 255, 255) or Color3.fromRGB(153, 153, 153)
    tab.TextSize = 11
    tab.Font = Enum.Font.GothamSemibold
    tab.Parent = TabsContainer
    
    if isActive then
        local indicator = Instance.new("Frame")
        indicator.Name = "ActiveIndicator"
        indicator.Size = UDim2.new(1, 0, 0, 2)
        indicator.Position = UDim2.new(0, 0, 1, 0)
        indicator.BackgroundColor3 = LARANJA
        indicator.BorderSizePixel = 0
        indicator.Parent = tab
        currentTab = tab
    end
    
    tab.MouseButton1Click:Connect(function()
        AimSection.Visible = false
        EspSection.Visible = false
        MiscSection.Visible = false
        targetSection.Visible = true
        
        for _, child in pairs(TabsContainer:GetChildren()) do
            if child:IsA("TextButton") then
                child.TextColor3 = Color3.fromRGB(153, 153, 153)
                if child:FindFirstChild("ActiveIndicator") then
                    child.ActiveIndicator:Destroy()
                end
            end
        end
        
        tab.TextColor3 = Color3.fromRGB(255, 255, 255)
        local indicator = Instance.new("Frame")
        indicator.Name = "ActiveIndicator"
        indicator.Size = UDim2.new(1, 0, 0, 2)
        indicator.Position = UDim2.new(0, 0, 1, 0)
        indicator.BackgroundColor3 = LARANJA
        indicator.BorderSizePixel = 0
        indicator.Parent = tab
        currentTab = tab
    end)
end

createTab("Aim", 0, true, AimSection)
createTab("Esp", 85, false, EspSection)
createTab("Misc", 170, false, MiscSection)

local isMinimized = false
local lastDotPosition = UDim2.new(0, 20, 0, 20)

local function minimizeUI()
    isMinimized = true
    MainContainer.Visible = false
    MinimizedDot.Visible = true
    MinimizedDot.Position = lastDotPosition
end

local function restoreUI()
    isMinimized = false
    MainContainer.Visible = true
    MinimizedDot.Visible = false
end

MinimizeButton.MouseButton1Click:Connect(minimizeUI)
MinimizedDot.MouseButton1Click:Connect(restoreUI)

local dragging = false
local dragInput
local dragStart
local startPos

local function update(input)
    local delta = input.Position - dragStart
    MainContainer.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
end

MainContainer.InputBegan:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 then
        dragging = true
        dragStart = input.Position
        startPos = MainContainer.Position
        
        input.Changed:Connect(function()
            if input.UserInputState == Enum.UserInputState.End then
                dragging = false
            end
        end)
    end
end)

MainContainer.InputChanged:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseMovement then
        dragInput = input
    end
end)

local dotDragging = false
local dotDragInput
local dotDragStart
local dotStartPos

local function updateDot(input)
    local delta = input.Position - dotDragStart
    local newPos = UDim2.new(0, dotStartPos.X.Offset + delta.X, 0, dotStartPos.Y.Offset + delta.Y)
    MinimizedDot.Position = newPos
    lastDotPosition = newPos
end

MinimizedDot.InputBegan:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 then
        dotDragging = true
        dotDragStart = input.Position
        dotStartPos = MinimizedDot.Position
        
        input.Changed:Connect(function()
            if input.UserInputState == Enum.UserInputState.End then
                dotDragging = false
                lastDotPosition = MinimizedDot.Position
            end
        end)
    end
end)

MinimizedDot.InputChanged:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseMovement then
        dotDragInput = input
    end
end)

UserInputService.InputChanged:Connect(function(input)
    if input == dragInput and dragging then
        update(input)
    elseif input == dotDragInput and dotDragging then
        updateDot(input)
    end
end)

UserInputService.InputEnded:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 then
        dragging = false
        dotDragging = false
    end
end)

local function toggleUI()
    if isMinimized then restoreUI() else minimizeUI() end
end

UserInputService.InputBegan:Connect(function(input, gameProcessed)
    if gameProcessed then return end
    if input.KeyCode == Enum.KeyCode.K then 
        toggleUI() 
    elseif input.KeyCode == Enum.KeyCode.H then
        State.dotInvisibilityEnabled = not State.dotInvisibilityEnabled
        MinimizedDot.BackgroundTransparency = State.dotInvisibilityEnabled and 1 or 0
    end
end)